name: Keep Backend Alive

on:
  schedule:
    # Run every 5 minutes to keep Render free tier awake
    # Cron format: minute hour day month weekday
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 1
    steps:
      - name: Ping Backend Health Endpoint
        run: |
          # Your Render backend URL
          BACKEND_URL="${BACKEND_URL:-https://portfolio-backend-1u0v.onrender.com}"
          
          echo "üèì Pinging backend to keep it alive: $BACKEND_URL/health"
          
          # Send GET request to health endpoint with timeout
          response=$(curl -s -w "\n%{http_code}" --max-time 10 "$BACKEND_URL/health" || echo "000")
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          if [ "$http_code" = "200" ]; then
            echo "‚úÖ Backend is alive! HTTP $http_code"
            echo "Response: $body"
            exit 0
          else
            echo "‚ö†Ô∏è Backend returned HTTP $http_code"
            if [ -n "$body" ]; then
              echo "Response: $body"
            fi
            # Don't fail the workflow - just log the issue
            exit 0
          fi

